type: object
title: Revision
description: "A *generic* revision model captures the serialized contents of any shema's single row. This is then subject to 1) cryptographic signature and 2) auditing.\n\nAside from \"successor\" column, a revision should be considered locked."
x-not-in-database: false

required:
  - id
  - schema_name
  - object_id
  - serialized_snapshot
  - serialized_hash
  - timestamp
properties:
  id:
    type: string
    format: ""
    example: ""
    description: ""

  schema_name:
    type: string
    format: ""
    example: ""
    description: 'This was previously called "schema" but for technical reasons should be called "schema_name"'

  object_id:
    type: string
    format: ""
    example: ""
    description: "The PK of the object that was serialized."

  signed_without_object_id:
    type: boolean
    format: ""
    example: ""
    description: "Indicates that object_id was left blank in serialized_snapshot when calculating serialized_hash. object_id may be subsequently filled in."

  serialized_snapshot:
    type: string
    format: ""
    example: ""
    description: "Revisioned data (serialized as JSON) as a dict {object_data: {...}, schema_name: ..., object_id: ..., signed_without_object_id: ..., timestamp: ..., authorized_by_individual: ..., authorized_by_other: ...}. It contains all the fields of the schema except id, successor, predessor_hash and predecessor_signature."

  serialized_hash:
    type: string
    format: ""
    example: ""
    description: "Hash of serialized_snapshot (SHA-1)"

  timestamp:
    type: string
    format: ""
    example: ""
    description: "Timestamp of when revisioning happened"

  authorized_by_individual:
    $ref: "./Individual.yaml"
    x-fk-model: "Individual"
    description: ""

  authorized_by_other:
    type: string
    format: ""
    example: ""
    description: "Reference to an admin user that has created this revision"

  successor:
    $ref: "./Revision.yaml"
    x-fk-model: "Revision"
    description: "This revision is no longer the latest revision, refer to its successor."

  predecessor_hash:
    type: string
    format: ""
    example: ""
    description: "Tamper-resistent artifact from previous record, copied from serialized_hash"

  predecessor_signature:
    type: string
    format: ""
    example: ""
    description: "Tamper-resistent artifact from previous record (we don't know if the previous record was signed or not)"
